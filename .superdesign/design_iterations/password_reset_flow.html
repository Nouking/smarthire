<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Password Reset Flow - B2B SaaS Platform</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="password_reset_theme.css" />
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <style>
      /* Additional component-specific styles */
      .flow-container {
        position: relative;
        overflow: hidden;
      }

      .step-content {
        display: none;
        animation: slideUp 0.4s ease-out;
      }

      .step-content.active {
        display: block;
      }

      .back-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--muted-foreground);
        text-decoration: none;
        font-size: 0.875rem;
        transition: color 0.2s ease-in-out;
      }

      .back-link:hover {
        color: var(--primary);
      }

      .help-text {
        background: var(--muted);
        border-radius: calc(var(--radius) - 2px);
        padding: 1rem;
        margin: 1rem 0;
        border-left: 3px solid var(--primary);
      }

      .help-text .help-title {
        font-weight: 500;
        color: var(--card-foreground);
        margin-bottom: 0.5rem;
      }

      .help-text .help-description {
        font-size: 0.875rem;
        color: var(--muted-foreground);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Brand Header -->
      <div class="brand-header">
        <a href="#" class="brand-logo">SmartHire</a>
      </div>

      <!-- Step Indicators -->
      <div class="step-indicators">
        <div class="step-dot active" id="step-dot-1"></div>
        <div class="step-dot" id="step-dot-2"></div>
        <div class="step-dot" id="step-dot-3"></div>
        <div class="step-dot" id="step-dot-4"></div>
      </div>

      <!-- Flow Container -->
      <div class="flow-container">
        <div class="card">
          <!-- Loading Overlay -->
          <div class="loading-overlay hidden" id="loading-overlay">
            <div class="spinner"></div>
          </div>

          <!-- Step 1: Email Input -->
          <div class="step-content active" id="step-email">
            <div class="card-header">
              <h1 class="card-title">Reset your password</h1>
              <p class="card-description">
                Enter your email address and we'll send you a link to reset your password.
              </p>
            </div>

            <!-- Error Alert -->
            <div class="alert alert-error hidden" id="email-error">
              <div class="flex items-center gap-2">
                <i data-lucide="alert-circle" class="h-4 w-4"></i>
                <span id="email-error-message">Please enter a valid email address.</span>
              </div>
            </div>

            <form id="email-form" class="space-y-4">
              <div class="form-group">
                <label for="email" class="form-label">Email address</label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  class="form-input"
                  placeholder="Enter your email address"
                  required
                  autocomplete="email"
                />
              </div>

              <button type="submit" class="btn btn-primary">
                <span class="btn-text">Send reset link</span>
                <div class="spinner hidden" id="email-spinner"></div>
              </button>
            </form>

            <div class="mt-6 text-center">
              <a href="#" class="back-link">
                <i data-lucide="arrow-left" class="h-4 w-4"></i>
                Back to login
              </a>
            </div>
          </div>

          <!-- Step 2: Email Sent -->
          <div class="step-content" id="step-sent">
            <div class="card-header">
              <div class="status-icon status-info">
                <i data-lucide="mail" class="h-6 w-6"></i>
              </div>
              <h1 class="card-title">Check your email</h1>
              <p class="card-description">We've sent a password reset link to:</p>
            </div>

            <div class="email-display" id="sent-email">user@example.com</div>

            <div class="help-text">
              <div class="help-title">What to expect:</div>
              <div class="help-description">
                • The email should arrive within 2-5 minutes<br />
                • Check your spam folder if you don't see it<br />
                • The link expires in 24 hours
              </div>
            </div>

            <button type="button" class="btn btn-secondary mb-4" id="resend-btn">
              <span class="btn-text">Resend email</span>
              <div class="spinner hidden" id="resend-spinner"></div>
            </button>

            <div class="text-center">
              <a href="#" class="back-link">
                <i data-lucide="arrow-left" class="h-4 w-4"></i>
                Back to login
              </a>
            </div>
          </div>

          <!-- Step 3: New Password -->
          <div class="step-content" id="step-reset">
            <div class="card-header">
              <h1 class="card-title">Set new password</h1>
              <p class="card-description">Choose a strong password for your account.</p>
            </div>

            <!-- Error Alert -->
            <div class="alert alert-error hidden" id="password-error">
              <div class="flex items-center gap-2">
                <i data-lucide="alert-circle" class="h-4 w-4"></i>
                <span id="password-error-message">Please check the password requirements.</span>
              </div>
            </div>

            <form id="password-form" class="space-y-4">
              <div class="form-group">
                <label for="new-password" class="form-label">New password</label>
                <input
                  type="password"
                  id="new-password"
                  name="password"
                  class="form-input"
                  placeholder="Enter new password"
                  required
                  autocomplete="new-password"
                />
              </div>

              <div class="form-group">
                <label for="confirm-password" class="form-label">Confirm password</label>
                <input
                  type="password"
                  id="confirm-password"
                  name="confirmPassword"
                  class="form-input"
                  placeholder="Confirm your password"
                  required
                  autocomplete="new-password"
                />
              </div>

              <div class="password-requirements">
                <div class="text-muted mb-2 text-xs">Password must contain:</div>
                <ul>
                  <li>
                    <div class="requirement-check" id="req-length">
                      <i data-lucide="check" class="h-3 w-3"></i>
                    </div>
                    At least 8 characters
                  </li>
                  <li>
                    <div class="requirement-check" id="req-uppercase">
                      <i data-lucide="check" class="h-3 w-3"></i>
                    </div>
                    One uppercase letter
                  </li>
                  <li>
                    <div class="requirement-check" id="req-lowercase">
                      <i data-lucide="check" class="h-3 w-3"></i>
                    </div>
                    One lowercase letter
                  </li>
                  <li>
                    <div class="requirement-check" id="req-number">
                      <i data-lucide="check" class="h-3 w-3"></i>
                    </div>
                    One number
                  </li>
                  <li>
                    <div class="requirement-check" id="req-match">
                      <i data-lucide="check" class="h-3 w-3"></i>
                    </div>
                    Passwords match
                  </li>
                </ul>
              </div>

              <button type="submit" class="btn btn-primary" id="update-password-btn" disabled>
                <span class="btn-text">Update password</span>
                <div class="spinner hidden" id="password-spinner"></div>
              </button>
            </form>
          </div>

          <!-- Step 4: Success -->
          <div class="step-content" id="step-success">
            <div class="card-header">
              <div class="status-icon status-success">
                <i data-lucide="check" class="h-6 w-6"></i>
              </div>
              <h1 class="card-title">Password updated!</h1>
              <p class="card-description">
                Your password has been successfully updated. You can now sign in with your new
                password.
              </p>
            </div>

            <div class="alert alert-success">
              <div class="flex items-center gap-2">
                <i data-lucide="check-circle" class="h-4 w-4"></i>
                <span>Password reset completed successfully</span>
              </div>
            </div>

            <button type="button" class="btn btn-primary" id="continue-login-btn">
              <span>Continue to login</span>
              <i data-lucide="arrow-right" class="h-4 w-4"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Password Reset Flow Logic
      class PasswordResetFlow {
        constructor() {
          this.currentStep = 1;
          this.email = '';
          this.initializeEventListeners();
          this.initializeLucideIcons();
        }

        initializeLucideIcons() {
          // Initialize Lucide icons
          if (typeof lucide !== 'undefined') {
            lucide.createIcons();
          }
        }

        initializeEventListeners() {
          // Email form submission
          document.getElementById('email-form').addEventListener('submit', (e) => {
            e.preventDefault();
            this.handleEmailSubmit();
          });

          // Resend email
          document.getElementById('resend-btn').addEventListener('click', () => {
            this.handleResendEmail();
          });

          // Password form submission
          document.getElementById('password-form').addEventListener('submit', (e) => {
            e.preventDefault();
            this.handlePasswordSubmit();
          });

          // Password validation
          document.getElementById('new-password').addEventListener('input', () => {
            this.validatePassword();
          });

          document.getElementById('confirm-password').addEventListener('input', () => {
            this.validatePassword();
          });

          // Continue to login
          document.getElementById('continue-login-btn').addEventListener('click', () => {
            this.handleContinueToLogin();
          });

          // Demo navigation buttons (for demonstration)
          this.addDemoControls();
        }

        showLoading() {
          document.getElementById('loading-overlay').classList.remove('hidden');
        }

        hideLoading() {
          document.getElementById('loading-overlay').classList.add('hidden');
        }

        showError(elementId, message) {
          const errorElement = document.getElementById(elementId);
          const messageElement = document.getElementById(elementId + '-message');
          if (messageElement) {
            messageElement.textContent = message;
          }
          errorElement.classList.remove('hidden');
        }

        hideError(elementId) {
          document.getElementById(elementId).classList.add('hidden');
        }

        updateStepIndicators() {
          for (let i = 1; i <= 4; i++) {
            const dot = document.getElementById(`step-dot-${i}`);
            if (i <= this.currentStep) {
              dot.classList.add('active');
            } else {
              dot.classList.remove('active');
            }
          }
        }

        showStep(stepNumber) {
          // Hide all steps
          document.querySelectorAll('.step-content').forEach((step) => {
            step.classList.remove('active');
          });

          // Show current step
          document.getElementById(`step-${this.getStepName(stepNumber)}`).classList.add('active');

          this.currentStep = stepNumber;
          this.updateStepIndicators();

          // Reinitialize icons after DOM changes
          setTimeout(() => {
            this.initializeLucideIcons();
          }, 100);
        }

        getStepName(stepNumber) {
          const steps = ['', 'email', 'sent', 'reset', 'success'];
          return steps[stepNumber];
        }

        async handleEmailSubmit() {
          const emailInput = document.getElementById('email');
          const email = emailInput.value.trim();

          // Validate email
          if (!this.isValidEmail(email)) {
            this.showError('email-error', 'Please enter a valid email address.');
            return;
          }

          this.hideError('email-error');
          this.email = email;

          // Show loading spinner
          const spinner = document.getElementById('email-spinner');
          const btnText = document.querySelector('#email-form .btn-text');
          spinner.classList.remove('hidden');
          btnText.textContent = 'Sending...';

          try {
            // Simulate API call to Supabase Auth
            await this.simulatePasswordResetRequest(email);

            // Update sent email display
            document.getElementById('sent-email').textContent = email;

            // Move to next step
            this.showStep(2);
          } catch (error) {
            this.showError('email-error', error.message);
          } finally {
            // Hide loading spinner
            spinner.classList.add('hidden');
            btnText.textContent = 'Send reset link';
          }
        }

        async handleResendEmail() {
          const spinner = document.getElementById('resend-spinner');
          const btnText = document.querySelector('#resend-btn .btn-text');

          spinner.classList.remove('hidden');
          btnText.textContent = 'Sending...';

          try {
            await this.simulatePasswordResetRequest(this.email);
            // Show success feedback (could add a toast notification here)
          } catch (error) {
            console.error('Resend failed:', error);
          } finally {
            spinner.classList.add('hidden');
            btnText.textContent = 'Resend email';
          }
        }

        async handlePasswordSubmit() {
          const newPassword = document.getElementById('new-password').value;
          const confirmPassword = document.getElementById('confirm-password').value;

          // Validate passwords
          if (!this.isPasswordValid(newPassword, confirmPassword)) {
            this.showError('password-error', 'Please ensure all password requirements are met.');
            return;
          }

          this.hideError('password-error');

          // Show loading spinner
          const spinner = document.getElementById('password-spinner');
          const btnText = document.querySelector('#password-form .btn-text');
          spinner.classList.remove('hidden');
          btnText.textContent = 'Updating...';

          try {
            // Simulate API call to update password
            await this.simulatePasswordUpdate(newPassword);

            // Move to success step
            this.showStep(4);
          } catch (error) {
            this.showError('password-error', error.message);
          } finally {
            // Hide loading spinner
            spinner.classList.add('hidden');
            btnText.textContent = 'Update password';
          }
        }

        handleContinueToLogin() {
          // In a real app, this would navigate to the login page
          alert('In a real application, this would navigate to the login page.');
          // For demo purposes, reset to first step
          this.showStep(1);
          document.getElementById('email-form').reset();
          document.getElementById('password-form').reset();
          this.hideError('email-error');
          this.hideError('password-error');
        }

        validatePassword() {
          const newPassword = document.getElementById('new-password').value;
          const confirmPassword = document.getElementById('confirm-password').value;

          // Check individual requirements
          const requirements = {
            length: newPassword.length >= 8,
            uppercase: /[A-Z]/.test(newPassword),
            lowercase: /[a-z]/.test(newPassword),
            number: /\d/.test(newPassword),
            match: newPassword === confirmPassword && newPassword.length > 0,
          };

          // Update requirement indicators
          Object.keys(requirements).forEach((req) => {
            const element = document.getElementById(`req-${req}`);
            if (requirements[req]) {
              element.classList.add('valid');
            } else {
              element.classList.remove('valid');
            }
          });

          // Enable/disable submit button
          const allValid = Object.values(requirements).every((valid) => valid);
          document.getElementById('update-password-btn').disabled = !allValid;

          return allValid;
        }

        isValidEmail(email) {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          return emailRegex.test(email);
        }

        isPasswordValid(password, confirmPassword) {
          return (
            password.length >= 8 &&
            /[A-Z]/.test(password) &&
            /[a-z]/.test(password) &&
            /\d/.test(password) &&
            password === confirmPassword
          );
        }

        // Simulation methods for demo purposes
        async simulatePasswordResetRequest(email) {
          return new Promise((resolve, reject) => {
            setTimeout(() => {
              // Simulate occasional errors for demo
              if (email === 'error@example.com') {
                reject(new Error('This email address is not registered.'));
              } else {
                resolve({ success: true });
              }
            }, 1500);
          });
        }

        async simulatePasswordUpdate(password) {
          return new Promise((resolve, reject) => {
            setTimeout(() => {
              // Simulate occasional errors for demo
              if (password === 'error123') {
                reject(new Error('Failed to update password. Please try again.'));
              } else {
                resolve({ success: true });
              }
            }, 2000);
          });
        }

        // Demo controls for testing different steps
        addDemoControls() {
          // Add demo buttons for testing (remove in production)
          const demoControls = document.createElement('div');
          demoControls.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: white;
                    padding: 10px;
                    border-radius: 8px;
                    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
                    border: 1px solid #e5e7eb;
                    font-size: 12px;
                    z-index: 1000;
                `;
          demoControls.innerHTML = `
                    <div style="margin-bottom: 8px; font-weight: 600;">Demo Controls:</div>
                    <button onclick="passwordResetFlow.showStep(1)" style="margin: 2px; padding: 4px 8px; font-size: 11px;">Email</button>
                    <button onclick="passwordResetFlow.showStep(2)" style="margin: 2px; padding: 4px 8px; font-size: 11px;">Sent</button>
                    <button onclick="passwordResetFlow.showStep(3)" style="margin: 2px; padding: 4px 8px; font-size: 11px;">Reset</button>
                    <button onclick="passwordResetFlow.showStep(4)" style="margin: 2px; padding: 4px 8px; font-size: 11px;">Success</button>
                `;
          document.body.appendChild(demoControls);
        }
      }

      // Initialize the password reset flow when DOM is loaded
      document.addEventListener('DOMContentLoaded', () => {
        window.passwordResetFlow = new PasswordResetFlow();
      });

      // Supabase Integration Examples (for reference)
      /*
        // Real Supabase implementation would look like this:
        
        // 1. Email Reset Request
        const { error } = await supabase.auth.resetPasswordForEmail(email, {
            redirectTo: `${window.location.origin}/reset-password`,
        });

        // 2. Password Update (from reset link)
        const { error } = await supabase.auth.updateUser({
            password: newPassword
        });

        // 3. TypeScript interfaces
        interface PasswordResetState {
            step: 'email' | 'sent' | 'reset' | 'success';
            email: string;
            isLoading: boolean;
            error?: string;
        }

        // 4. Next.js Server Action example
        async function resetPassword(formData: FormData) {
            'use server'
            
            const email = formData.get('email') as string;
            const supabase = createServerComponentClient({ cookies });
            
            const { error } = await supabase.auth.resetPasswordForEmail(email, {
                redirectTo: `${process.env.NEXT_PUBLIC_SITE_URL}/reset-password`,
            });
            
            if (error) {
                return { error: error.message };
            }
            
            return { success: true };
        }
        */
    </script>
  </body>
</html>
